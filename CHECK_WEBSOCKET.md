# AlgoLab WebSocket BaÄŸlantÄ± KontrolÃ¼

## ğŸ” IntelliJ Console'da Aranacak Loglar

Backend'i IDE'den baÅŸlattÄ±ÄŸÄ±nÄ±zda IntelliJ Console'da ÅŸu loglarÄ± aramalÄ±sÄ±nÄ±z:

### âœ… BaÅŸarÄ±lÄ± BaÄŸlantÄ± LoglarÄ±

```
1. Startup LoglarÄ±:
   - "AlgoLabWebSocketService initialized"
   - "WebSocket auto-connect successful"
   - "Loading saved AlgoLab session"

2. BaÄŸlantÄ± LoglarÄ±:
   - "âœ… WebSocket connected"
   - "Connected to AlgoLab WebSocket"
   - "WebSocket connection established"

3. Subscription LoglarÄ±:
   - "âœ… IMMEDIATE subscription sent"
   - "Subscription message sent for symbols: [USDTRY]"

4. Veri AlÄ±m LoglarÄ±:
   - "âœ… Received TICK data: Symbol=USDTRY"
   - "Processing tick for USDTRY"
   - "Message buffered: Type=T"
```

### âŒ Sorun GÃ¶stergeleri

```
- "WebSocket auto-connect failed"
- "No saved session found"
- "Connection closed with code: 1006"
- "Authentication failed"
- "Session expired"
```

---

## ğŸ§ª Manuel Test YÃ¶ntemleri

### 1. Health Check
```bash
curl http://localhost:8080/actuator/health
# SonuÃ§: status "UP" olmalÄ±
```

### 2. Session KontrolÃ¼
```bash
cat algolab-session-dev.json | jq '.'
# Token ve hash olmalÄ±
# lastUpdate son 24 saat iÃ§inde olmalÄ±
```

### 3. Port KontrolÃ¼
```bash
lsof -i :8080 | grep LISTEN
# Backend Ã§alÄ±ÅŸÄ±yor olmalÄ±
```

### 4. CLI ile Test
```bash
cd cli-client
./start.sh
# Menu: 2 â†’ 5 (Real-Time Tick Data)
# Symbol: USDTRY
# EÄŸer veri geliyorsa WebSocket Ã§alÄ±ÅŸÄ±yor demektir
```

---

## ğŸ“Š Config Durumu

### âœ… Mevcut Ayarlar (application-dev.yml)
```yaml
algolab:
  websocket:
    enabled: true
    url: wss://www.algolab.com.tr/api/ws
    auto-connect: true
    heartbeat-interval: 900000  # 15 dakika
```

### âœ… Session DosyasÄ±
- **Konum:** `algolab-session-dev.json` (root dizin)
- **Durum:** âœ… Mevcut
- **Son GÃ¼ncelleme:** 2025-10-17 16:23:30

---

## ğŸ”„ WebSocket BaÄŸlantÄ±sÄ± NasÄ±l Ã‡alÄ±ÅŸÄ±r?

1. **Startup (@PostConstruct)**
   - `AlgoLabWebSocketService` baÅŸlatÄ±lÄ±r
   - `algolab-session-dev.json` dosyasÄ± okunur
   - EÄŸer session varsa otomatik baÄŸlantÄ± baÅŸlar

2. **BaÄŸlantÄ±**
   - WebSocket client oluÅŸturulur
   - Headers eklenir (APIKEY, Authorization, Checker)
   - `wss://www.algolab.com.tr/api/ws` adresine baÄŸlanÄ±r

3. **Subscription**
   - BaÄŸlantÄ± kurulur kurulmaz subscription mesajÄ± gÃ¶nderilir
   - VarsayÄ±lan sembol: USDTRY
   - Format: `{"token": "...", "Type": "T", "Symbols": ["USDTRY"]}`

4. **Veri AkÄ±ÅŸÄ±**
   - AlgoLab server tick data gÃ¶nderir
   - Backend buffer'a ekler
   - HTTP API Ã¼zerinden eriÅŸilebilir hale gelir

---

## ğŸ› ï¸ Sorun Giderme

### WebSocket BaÄŸlanmÄ±yorsa:

**1. Session Expired**
```bash
# CLI ile yeni login yap
cd cli-client
./start.sh
# Menu: 2 â†’ 1 (AlgoLab Login)
```

**2. Config HatasÄ±**
```bash
# application-dev.yml kontrol et
grep -A5 "websocket:" src/main/resources/application-dev.yml
```

**3. Port Ã‡akÄ±ÅŸmasÄ±**
```bash
# Backend portunu kontrol et
lsof -i :8080
# EÄŸer baÅŸka uygulama varsa kill et
```

**4. Manuel WebSocket BaÅŸlatma**
```bash
# Test endpoint ile
curl -X POST http://localhost:8080/api/test/websocket/connect-v2
```

---

## ğŸ“ Log Seviyeleri

IntelliJ'de log seviyesini artÄ±rmak iÃ§in:

1. **application-dev.yml** dosyasÄ±na ekle:
```yaml
logging:
  level:
    com.bisttrading.broker.algolab.websocket: DEBUG
    com.bisttrading.broker.algolab.service: DEBUG
```

2. **Restart** backend

3. Console'da detaylÄ± loglarÄ± gÃ¶r

---

## âœ… BaÅŸarÄ±lÄ± BaÄŸlantÄ± Ã–rneÄŸi

IntelliJ Console'da ÅŸu sÄ±rayÄ± gÃ¶rmelisiniz:

```
2025-10-17 16:00:00.123  INFO --- AlgoLabWebSocketService : AlgoLabWebSocketService initialized
2025-10-17 16:00:00.234  INFO --- AlgoLabAuthService      : Loading saved AlgoLab session from file
2025-10-17 16:00:00.345  INFO --- AlgoLabWebSocketService : Session loaded, attempting auto-connect
2025-10-17 16:00:01.456  INFO --- AlgoLabWebSocketClient  : âœ… WebSocket connected
2025-10-17 16:00:01.567  INFO --- AlgoLabWebSocketClient  : âœ… IMMEDIATE subscription sent: [USDTRY]
2025-10-17 16:00:02.678  INFO --- AlgoLabWebSocketClient  : âœ… Received TICK data: Symbol=USDTRY, Price=34.1234
```

Bu sÄ±rayÄ± gÃ¶rÃ¼yorsanÄ±z her ÅŸey Ã§alÄ±ÅŸÄ±yor demektir! ğŸ‰

---

**OluÅŸturulma:** 2025-10-17
**GÃ¼ncelleme:** Auto-generated by Claude Code
