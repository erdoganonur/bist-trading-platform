# =============================================================================
# Redis Sentinel Configuration for BIST Trading Platform
# High Availability and Automatic Failover
# =============================================================================

# =============================================================================
# BASIC CONFIGURATION
# =============================================================================
bind 0.0.0.0
port 26379
sentinel announce-ip auto
sentinel announce-port 26379

# =============================================================================
# MASTER MONITORING CONFIGURATION
# =============================================================================
# Monitor the Redis master instances
sentinel monitor redis-master-1 172.20.0.11 6379 2
sentinel monitor redis-master-2 172.20.0.12 6379 2
sentinel monitor redis-master-3 172.20.0.13 6379 2

# Authentication (configure if Redis instances use auth)
# sentinel auth-pass redis-master-1 TradingPlatformSecurePassword123!
# sentinel auth-pass redis-master-2 TradingPlatformSecurePassword123!
# sentinel auth-pass redis-master-3 TradingPlatformSecurePassword123!

# =============================================================================
# FAILOVER TIMING CONFIGURATION
# =============================================================================
# Time in milliseconds after which sentinel considers master down
sentinel down-after-milliseconds redis-master-1 5000
sentinel down-after-milliseconds redis-master-2 5000
sentinel down-after-milliseconds redis-master-3 5000

# Timeout for failover operation
sentinel failover-timeout redis-master-1 60000
sentinel failover-timeout redis-master-2 60000
sentinel failover-timeout redis-master-3 60000

# Number of replicas to reconfigure during failover
sentinel parallel-syncs redis-master-1 1
sentinel parallel-syncs redis-master-2 1
sentinel parallel-syncs redis-master-3 1

# =============================================================================
# NOTIFICATION SCRIPTS (Optional)
# =============================================================================
# Script to run when master changes
# sentinel notification-script redis-master-1 /opt/redis/scripts/notify.sh
# sentinel client-reconfig-script redis-master-1 /opt/redis/scripts/reconfig.sh

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
logfile /var/log/redis/sentinel.log
loglevel notice
syslog-enabled no

# =============================================================================
# SECURITY SETTINGS
# =============================================================================
# Sentinel authentication (configure in production)
# requirepass SentinelSecurePassword123!

# Protected mode
protected-mode no

# Disable dangerous commands
# sentinel deny-scripts-reconfig yes

# =============================================================================
# PERFORMANCE SETTINGS
# =============================================================================
# Connection settings
tcp-keepalive 60
timeout 0

# Sentinel working directory
dir /tmp

# =============================================================================
# CLUSTER AWARENESS
# =============================================================================
# Enable cluster mode awareness
sentinel resolve-hostnames yes
sentinel announce-hostnames yes

# =============================================================================
# TRADING PLATFORM SPECIFIC SETTINGS
# =============================================================================
# Custom sentinel configuration for trading workloads
sentinel master-reboot-down-after-period redis-master-1 0
sentinel master-reboot-down-after-period redis-master-2 0
sentinel master-reboot-down-after-period redis-master-3 0

# Deny sentinel reconfiguration
sentinel deny-scripts-reconfig no

# =============================================================================
# MONITORING AND ALERTING
# =============================================================================
# Log sentinel events for monitoring
sentinel announce-ip auto
sentinel announce-port 26379

# =============================================================================
# HIGH AVAILABILITY NOTES
# =============================================================================
# 1. Minimum 3 Sentinel instances recommended for quorum
# 2. down-after-milliseconds set to 5000ms for fast detection
# 3. failover-timeout set to 60s to handle network partitions
# 4. parallel-syncs set to 1 to minimize replication load during failover
# 5. Sentinel runs on port 26379 (default)
# 6. Each master has its own monitoring configuration
# 7. Quorum set to 2 requires at least 2 sentinels to agree on failover